@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@Styles.Render("~/ManageUser/css")
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header text-center d-flex justify-content-sm-center">
                    <h2 class="card-title">Manage User</h2>
                </div>

                <div class="card-body">
                    <a class="btn btn-info btnTableCustom mb-1" id="myButton"><i class="fas fa-plus-circle"></i> Add</a>
                    <table id="tableUser" class="table table-striped">
                        <thead>
                            <tr>
                                <th>No.</th>
                                <th>UserName</th>
                                <th>FirstName</th>
                                <th>LastName</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Created Time</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true" backdrop="static" keyboard="false">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content p-4">
            <div class="d-flex justify-content-end">
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close" id="btnAdd">x</button>
            </div>
            <div class="modal-body p-0">
                <form method="post" id="formUser">
                    <h3 class="text-center">ADD USER</h3>
                    <div class="row pb-2">
                        <div class="col-6">
                            <label class="form-label"><sup>*</sup>FirstName:</label>
                            <input type="text" class="form-control" name="FirstName" id="addFirstName" />
                        </div>
                        <div class="col-6">
                            <label class="form-label"><sup>*</sup>LastName:</label>
                            <input type="text" class="form-control" name="LastName" id="addLastName" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 pb-2">
                            <label class="form-label"><sup>*</sup>Email:</label>
                            <input type="email" class="form-control" name="Email" id="addEmail" />
                        </div>

                        <div class="col-12 pb-2">
                            <label class="form-label"><sup>*</sup>Phone:</label>
                            <input type="text" class="form-control" name="Phone" id="addPhone" />
                        </div>

                        <div class="col-12 pb-2">
                            <label class="form-label"><sup>*</sup>UserName:</label>
                            <input type="text" class="form-control" name="UserName" id="addUserName" />
                        </div>
                        <div class="col-12 pb-2">
                            <label class="form-label"><sup>*</sup>Password:</label>
                            <input type="password" class="form-control" name="Password" id="password" />
                        </div>
                        <div class="col-12 pb-2">
                            <label class="form-label"><sup>*</sup>Confirm Password:</label>
                            <input type="password" class="form-control" name="confirm_password" />
                        </div>
                    </div>
                    <div class="pt-3 d-flex justify-content-end">
                        <button class="btn btn-primary w-25">Add User</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="inforUserDetail" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true" backdrop="static" keyboard="false">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content p-4">
            <div class="d-flex justify-content-end">
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close" id="btnEdit">x</button>
            </div>
            <div class="modal-body p-0">
                <h3 class="text-center">EDIT USER</h3>
                <form action="/User/EditUser" method="post" id="formEdit">
                    <div class="row pb-2">
                        <div class="col-6">
                            <label class="form-label"><sup>*</sup>FirstName:</label>
                            <input type="text" class="form-control" name="FirstName" id="editFirstName" />
                        </div>
                        <div class="col-6">
                            <label class="form-label"><sup>*</sup>LastName:</label>
                            <input type="text" class="form-control" name="LastName" id="editLastName" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 pb-2">
                            <label class="form-label"><sup>*</sup>Email:</label>
                            <input type="email" class="form-control" name="Email" id="editEmail" />
                        </div>
                        <input type="hidden" class="form-control" name="Id" id="editId" readonly />
                        <div class="col-12 pb-2">
                            <label class="form-label"><sup>*</sup>Phone:</label>
                            <input type="text" class="form-control" name="Phone" id="editPhone" />
                        </div>
                        <div class="col-12 pb-2">
                            <label class="form-label"><sup>*</sup>UserName:</label>
                            <input type="text" class="form-control" name="UserName" id="editUserName" readonly />
                        </div>
                        <input type="hidden" class="form-control" name="Password" id="editPassword" />
                    </div>
                    <div class="pt-3 d-flex justify-content-end">
                        <button class="btn btn-primary w-25" type="submit">Save User</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
@section scripts {
    @Scripts.Render("~/AdminLte/js")
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/Validate/Js")
    <script>
        $('#myButton').on('click', function () {
            $('#exampleModal').modal({
                backdrop: 'static',
                keyboard: false
            });
        });
        $('#myButton').on('click', function () {
            $('#exampleModal').modal('show');
        });

        $('#btnAdd').on('click', function () {
            $('#exampleModal').modal('hide');
        });

        $('#btnEdit').on('click', function () {
            $('#inforUserDetail').modal('hide');
        });

        function EditUser(id) {
            $.ajax({
                url: "/User/GetUserToEdit",
                type: "get",
                data: {
                    userId: id
                },
                success: function (response) {
                    $('#editId').val(response.Id);
                    $('#editFirstName').val(response.FirstName);
                    $('#editLastName').val(response.LastName);
                    $('#editEmail').val(response.Email);
                    $('#editPhone').val(response.Phone);
                    $('#editUserName').val(response.UserName);
                    $('#editPassword').val(response.Password);
                    $('#inforUserDetail').modal({
                        backdrop: 'static',
                        keyboard: false
                    });
                    $('#inforUserDetail').modal('show');
                },
                error: function (xhr) {
                    console.log(first_name)
                    console.log(xhr)
                }
            });
        };

        function DeleteUser(id) {
            Swal.fire({
                title: "Are you sure?",
                text: "Will you delete user",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Yes, delete user!"
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        url: "/User/DeleteUser",
                        type: "get",
                        data: {
                            userId: id
                        },
                        success: function (response) {
                            if (response.success == true) {
                                Swal.fire({
                                    title: "Deleted!",
                                    text: response.message,
                                    icon: "success",
                                    timer: 3000
                                });
                                setTimeout(() => {
                                    location.reload();
                                }, 2000)
                            }

                            if (response.notifi == false) {
                                Swal.fire({
                                    title: "Deleted!",
                                    text: response.errorMessage,
                                    icon: "error",
                                    timer: 3000
                                });
                            }
                        },
                        error: function (xhr) {
                            console.log(xhr)
                        }
                    })
                }
            });
        };

        const result = '@TempData["updateSuccess"]';
        if (result) {
            Swal.fire({
                position: "top-end",
                icon: "success",
                title: result,
                showConfirmButton: false,
                timer: 1500
            });
        }

        const resultFailed = '@TempData["updateFailed"]';
        if (resultFailed) {
            Swal.fire({
                position: "top-end",
                icon: "error",
                title: resultFailed,
                showConfirmButton: false,
                timer: 1500
            });
        }

        const resultAdd = '@TempData["AddSuccess"]';
        if (resultAdd) {
            Swal.fire({
                position: "top-end",
                icon: "success",
                title: resultAdd,
                showConfirmButton: false,
                timer: 1500
            });
        }

    </script>
}